<!doctype HTML>
<body>
  <h1>
  <span id="tokenName"></span> ウォレット
  </h1>
  
  <h2>
  アカウント
  </h2>
  <p id="account">
  0x
  </p>
  <h2>
  残高
  </h2>
  <p>
  <span id="balance"></span><span id="tokenSymbol"></span> （ <span id="balanceYen"></span> 円）
  </p>
  
  <form id="transferForm">
    <input type="text" id="transferTo" />
    <input type="number" id="transferAmount" />
    <input type="submit" value="送金する" />
  </form>
  
  <h2>
  トランザクション一覧
  </h2>
  <ol id="transactionList">
  </ol>
  <script>

const address = "0x9DA9eB74A78d10EC29AE1Ebed2fACcDa30ba8b36";
const abi = [{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x06fdde03"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x095ea7b3"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x18160ddd"},{"constant":false,"inputs":[{"name":"from","type":"address"},{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x23b872dd"},{"constant":true,"inputs":[],"name":"CFO","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x30d500bf"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x313ce567"},{"constant":true,"inputs":[],"name":"cap","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x355274ea"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x39509351"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"mint","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x40c10f19"},{"constant":true,"inputs":[{"name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x70a08231"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x95d89b41"},{"constant":false,"inputs":[{"name":"account","type":"address"}],"name":"addMinter","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x983b2d56"},{"constant":false,"inputs":[],"name":"renounceMinter","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x98650275"},{"constant":true,"inputs":[],"name":"CEO","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xa1088571"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xa457c2d7"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xa9059cbb"},{"constant":true,"inputs":[{"name":"account","type":"address"}],"name":"isMinter","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xaa271e1a"},{"constant":true,"inputs":[{"name":"owner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xdd62ed3e"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor","signature":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"account","type":"address"}],"name":"MinterAdded","type":"event","signature":"0x6ae172837ea30b801fbfcdd4108aa1d5bf8ff775444fd70256b44e6bf3dfc3f6"},{"anonymous":false,"inputs":[{"indexed":true,"name":"account","type":"address"}],"name":"MinterRemoved","type":"event","signature":"0xe94479a9f7e1952cc78f2d6baab678adc1b772d936c6583def489e524cb66692"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event","signature":"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event","signature":"0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"},{"constant":false,"inputs":[{"name":"newCEO","type":"address"}],"name":"setCEO","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x27d7874c"},{"constant":false,"inputs":[{"name":"newCFO","type":"address"}],"name":"setCFO","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x4e0a3379"},{"constant":false,"inputs":[],"name":"withdrawEther","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x7362377b"},{"constant":false,"inputs":[{"name":"account","type":"address"}],"name":"removeMinter","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x3092afd5"}];

  // Javascript
  window.addEventListener("load", () => {
    console.log("load");
    window.web3.eth.getAccounts((error, result) => {
      const account = result[0];
      console.log(account);
      
      const p_account = document.getElementById("account");
      p_account.innerText = account;
      
      const contract = window.web3.eth.contract(abi).at(address);
      console.log(contract);
      
      contract.name({from: account}, (error, result) => {
        const span_tokenName = document.getElementById("tokenName");
        span_tokenName.innerText = result;
      });
     
      contract.balanceOf(account, {from: account}, (error, result) => {
        const span_balance = document.getElementById("balance");
        span_balance.innerText = window.web3.fromWei(result, "ether");
        
        fetch("https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=jpy")
          .then(response => {
            return response.json()
          })
          .then(json => {
            const balance = window.web3.fromWei(result, "ether");
            const balance_in_yen = balance * json.ethereum.jpy;
            
            const span_balanceYen = document.getElementById("balanceYen");
            span_balanceYen.innerText = balance_in_yen;
          })
      });
      
      contract.symbol({from: account}, (error, result) => {
        const span_tokenSymbol = document.getElementById("tokenSymbol");
        span_tokenSymbol.innerText = result;
      });
      
      const transferForm = document.getElementById("transferForm");
      transferForm.addEventListener("submit", event => {
        event.preventDefault();
        
        const inputTransferTo = document.getElementById("transferTo");
        const inputTransferAmount = document.getElementById("transferAmount");
        
        const to = inputTransferTo.value;
        const amount = inputTransferAmount.value;
        
        if (to === "" || amount === "") {
          return;
        }
        
        contract.transfer(to, amount, {from: account}, (error, result) => {
          console.log(result);
          
          const olTransactionList = document.getElementById("transactionList");
          olTransactionList.innerHTML = olTransactionList.innerHTML + `
          <li><a href="https://ropsten.etherscan.io/tx/${result}" target="_blank">送金： To ${to} Amount: ${amount}</a></li>
          `;
        });
      });
    });
    
    // x
  });
  </script>
</body>
